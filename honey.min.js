/*
|--------------------------------------------------------------------------
| An open source Javascript Honey Pot implementation
|--------------------------------------------------------------------------
|
| @version 1.1.0
| @author Zudd ( Hung Luu )
| @url https://github.com/zudd/honeyjs
| @license The MIT License (MIT)
|
| Copyright (c) 2015 Hung Luu
*/
var honey=function(){var e,b,f;e={theme:"light",type:"image",size:"normal",time:6,holderClass:"honeyjs",key:null,forceCaptcha:!1};b={getForms:function(){return document.getElementsByTagName("form")},now:function(){return Date.now?Date.now():(new Date).getTime()},installReCaptchaCallbacks:function(a,d){d.callback=function(d){a.save(d)};d["expired-callback"]=function(){a.reset()};return d},activateReCaptchaAutomatically:function(a){function d(){a.activateCaptcha()}setTimeout(d,300);return d},installjQueryPlugin:function(a,
d,c){return a?(a.fn[d]=c,!0):!1},find:function(a,d){if(d.indexOf)return d.indexOf(a);for(var c=0,b=d.length;c<b;c++)if(d[c]===a)return c;return-1},contains:function(a,d){return-1!==b.find(a,d)},getHolder:function(a,d){var c;if(a.getElementsByClassName)return c=a.getElementsByClassName(d),c.length?c[0]:a;var f;c=a.getElementsByTagName("*");for(var e=0,g=c.length;e<g;e++)if(f=c[e].className.split(" "),~b.find(d,f))return c[e];return a},hiddenInput:function(a,d){var b=document.createElement("input");
b.name=d;b.style.display="none";b.style.visibility="hidden";a.appendChild(b);return b},bind:function(a,d,c,f){function e(a){var d=c.call(f,a);!1===d&&b.cancel(a);return d}a.addEventListener?a.addEventListener(d,e,!1):a.attachEvent("on"+d,e);return e},cancel:function(a){if(a=a||window.event)a.cancelBubble=!0,a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault();return!1},getInputByName:function(a,d){for(var b=a.getElementsByTagName("input"),e=0,f=b.length;e<f;e++)if(b[e].name===
d)return b[e]},isDev:function(){return!navigator.plugins.length},__installDev:function(a){a&&(f.dev=b);return!!a},Collector:function(){},ReCaptcha:function(){this.response=this.id=this.key=this.holder=null},Hook:function(){},Pot:function(a){this.options=e;this.form=a;this.createdAt=b.now();this.holder=b.getHolder(a,e.holderClass);this.empty=b.hiddenInput(this.holder,"name");this.time=b.hiddenInput(this.holder,"_time");this.hooks={};this.hooks.validate=new b.Hook;this.hooks.fail=new b.Hook;this.re=
new b.ReCaptcha;b.bind(a,"submit",function(){return this.valid()},this)();this.re.key=this.options.key;e.forceCaptcha&&this.options.key&&b.activateReCaptchaAutomatically(this)},Pots:function(){}};b.Collector.prototype=Array.prototype;b.Collector.prototype.find=function(a){return b.find(a,this)};b.Collector.prototype.has=function(a){return b.contains(a,this)};b.Collector.prototype.remove=function(a){a=this.find(a);var b=~a;b&&this.splice(a,1);return b};b.Collector.prototype.flush=function(){this.length=
0};b.Hook.prototype=b.Collector.prototype;b.Hook.prototype.exec=function(a){for(var b=!0,c=0,e=this.length;c<e&&(b=this[c].call(a),!1!==b);c++);return b};b.ReCaptcha.prototype={ready:function(){return null!==this.holder},required:function(){return null!==this.key},load:function(a){"undefined"!==typeof grecaptcha&&this.required()&&!this.ready()&&(this.holder=document.createElement("div"),a.sitekey=this.key,b.installReCaptchaCallbacks(this,a),this.id=grecaptcha.render(this.holder,a));return this.holder},
save:function(a){this.response=a},reset:function(){this.key&&this.id&&"undefined"!==typeof grecaptcha&&grecaptcha.reset(this.id)},valid:function(){return this.required()?"undefined"===typeof grecaptcha?!1:this.ready()&&null!==this.response:!0}};b.Pot.prototype={valid:function(){var a=b.now();if(this.hooks.validate.exec(this)&&""===this.empty.value&&!this.fast(a)&&this.re.valid())return this.time.value=a,!0;this.activateCaptcha();this.hooks.fail.exec(this);return!1},name:function(a){a&&(this.empty.name=
a);return this.empty.name},validate:function(a){this.hooks.validate.push(a);return this},fail:function(a){this.hooks.fail.push(a);return this},config:function(a){if("string"===typeof a)return this.options[a];for(var b in a)this.options[b]=a[b];return this},captcha:function(a){this.re.key=a||e.key;return this},fast:function(a){a=a||b.now();return a-this.createdAt<=this.options.time},input:function(a){return b.getInputByName(this.form,a)},value:function(a){if(a=this.input(a))return a.value},push:function(a){a&&
this.holder.appendChild(a)},activateCaptcha:function(){this.push(this.re.load({theme:this.options.theme,type:this.options.type,size:this.options.size}))}};b.Pots.prototype=b.Collector.prototype;b.Pots.prototype.each=function(a){for(var b=0,c=this.length;b<c;b++)a(b,this[b]);return this};b.Pots.prototype.captcha=function(a){return this.each(function(b,c){c.captcha(a)})};b.Pots.prototype.config=function(a){return"string"===typeof a&&this.length?this[0].config(a):this.each(function(b,c){c.config(a)})};
b.Pots.prototype.validate=function(a){return this.each(function(b,c){c.validate(a)})};b.Pots.prototype.fail=function(a){return this.each(function(b,c){c.fail(a)})};f=function(a){if("string"===typeof a&&"undefined"!==typeof jQuery)return f(jQuery(a));if(a instanceof HTMLFormElement)return new b.Pot(a);if(1===a.length)return f(a[0]);for(var d=new b.Pots,c=0,e=a.length;c<e;c++)d.push(f(a[c]));return d};f.requireCaptcha=function(a){e.key=a;return e.key};f.forceCaptcha=function(a){e.forceCaptcha=!!f.requireCaptcha(a);
return e.forceCaptcha};f.config=function(a){if("string"===typeof a)return e[a];for(var b in a)e[b]=a[b]};f.all=function(){return f(b.getForms())};b.installjQueryPlugin(jQuery,"honey",function(a){return a?"string"===typeof a?f(this).captcha(a):f(this).config(a):f(this)});b.__installDev(b.isDev());return f}();